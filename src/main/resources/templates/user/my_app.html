<!DOCTYPE html>
<html lang="en"  xmlns:th="http://www.thymeleaf.org" th:fragment="parent(content,title,script)">
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- Viewport meta tag -->

<head>
    <title data-th-text="${customer != null ? (customer.getFirstName() != null ? customer.getFirstName() : (customer.getMobileNumber() != null ? customer.getMobileNumber() : 'Profile Page')) : 'Profile Page'}">Profile Page</title>

    <!-- Bootstrap Datepicker CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/css/bootstrap-datepicker.min.css">

    <!-- DataTables CSS -->  
    <link rel="stylesheet" href="https://cdn.datatables.net/1.11.3/css/jquery.dataTables.min.css">

    <!-- DataTables Bootstrap 4 Integration CSS -->
    <link rel="stylesheet" href="https://cdn.datatables.net/1.11.3/css/dataTables.bootstrap4.min.css">

    <!-- DataTables Select CSS -->
    <link rel="stylesheet" href="https://cdn.datatables.net/select/1.3.3/css/select.dataTables.min.css">
    
    <!-- Common CSS -->
   <link rel="stylesheet" th:href="@{/css/common.css}">
   <!-- Font Awesome -->
   <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css">
    <link
    href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i"
    rel="stylesheet">
    <!-- Custom CSS -->
  	<link rel="stylesheet" th:href="@{/css/custom.css}">
    <link rel="stylesheet" th:href="@{/css/sidebar.scss}">
    <link rel="stylesheet" th:href="@{/css/min.css}">
    <link rel="stylesheet" th:href="@{/css/admin2.css}">
	 <style>
       .centered-content {
    padding-left: 15px;  /* default padding for mobile devices */
    padding-right: 15px; /* default padding for mobile devices */
}

@media (min-width: 1200px) {
    .centered-content {
        padding-left: 400px; /* increased padding for larger screens */
        padding-right: 400px; /* increased padding for larger screens */
    }
}


#merchantList {
    display: flex;
    flex-wrap: nowrap;
    overflow-x: auto;
    padding: 1rem;
}

#merchantList .card {
    flex: 0 0 auto;
    margin-right: 1rem; /* Adjust spacing between cards */
    min-width: 250px; /* Ensure the cards have a minimum width */
    max-width: 250px; /* Optional: Ensure the cards have a maximum width */
}

#merchantList .card-body {
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    height: 100%;
}

#merchantList .row.no-gutters {
    flex: 1;
}

/* For WebKit browsers (Chrome, Safari) */
#merchantList::-webkit-scrollbar {
    height: 8px; /* Height of horizontal scrollbar */
    width: 8px;  /* Width of vertical scrollbar */
}

#merchantList::-webkit-scrollbar-track {
    background: #f1f1f1; 
}

#merchantList::-webkit-scrollbar-thumb {
    background: #888; 
    border-radius: 10px;
}

#merchantList::-webkit-scrollbar-thumb:hover {
    background: #555; 
}

/* For Firefox */
#merchantList {
    scrollbar-width: thin;          /* "auto" or "thin" */
    scrollbar-color: #888 #f1f1f1;  /* Scrollbar thumb and track */
}

    #dynamicCard {
        overflow: hidden;
    }
    .card-body {
        overflow: auto;
    }
    .chart-area {
        padding: 10px;
    }



  /* Define the keyframes for the bounce animation */
    @keyframes bounceIn {
        0% {
            transform: translateY(-100%);
            opacity: 0;
        }
        50% {
            transform: translateY(0);
        }
        100% {
            opacity: 1;
        }
    }

    /* Apply the animation to the exclamation circle */
    .exclamation-circle {
        animation: bounceIn 0.5s ease-in-out;
    }

  /* Define the keyframes for the bounce animation */
        @keyframes bounce {
            0% { transform: translateY(-50%); }
            50% { transform: translateY(0); }
            100% { transform: translateY(-50%); }
        }

        /* Apply the animation to the icon */
        .icon_ {
            animation: bounce 1s infinite;
        }
        
 .profile-score-container {
    width: 100%;
    background-color: #f0f0f0;
    border-radius: 10px;
    overflow: hidden;
   
    padding: 5px;
}

.profile-score-bar {
    height: 10px; /* Adjusted height for a thinner bar */
    line-height: 10px;
    text-align: center;
    color: white;
    border-radius: 10px;
    animation: fillBar 2s forwards;
    background: linear-gradient(to right, var(--color) 0%, var(--color) var(--percentage), #f0f0f0 var(--percentage), #f0f0f0 100%);
    width: 0;
}

@keyframes fillBar {
    from { width: 0; }
    to { width: var(--percentage); }
}

.additional-content {
    font-size: 14px;
    color: #333;
    padding: 15px;
}

.border-primary-all-sides {
    border: 0.2rem solid #4e73df; /* Apply primary color border to all sides */
}

/* 3D card effect */
.card-3d-effect {
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    border-radius: 10px;
}

.card-3d-effect:hover {
    transform: translateY(-10px);
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
}


 /* Large round user icon */
        .user-icon {
            display: flex;
            justify-content: center;
            align-items: center;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-color: #f0f0f0;
            margin: 0 auto 20px;
            font-size: 15px;
            color: #4e73df;
        }



    /* Add animation to the card */
        .card_ {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            border-radius: 10px;
        }

        .card_:hover {
            transform: translateY(-10px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }

        /* Icon animations */
        .icon {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.1);
            }
            100% {
                transform: scale(1);
            }
        }

        /* Alert animations */
        .alert-animation {
            animation: fadeIn 1s ease-in-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Container styling */
        .container-fluid {
            margin-top: 100px;
        }

        .card-body .form-row {
            margin-bottom: 1rem;
        }

        /* Button styling */
        .btn-icon-split {
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.3s, color 0.3s;
        }

        .btn-icon-split:hover {
            background-color: #4e73df;
            color: #fff;
        }

        /* Icon styling */
        .btn-icon-split .icon {
            padding: 0.5rem;
            background-color: #4e73df;
            color: #fff;
            border-radius: 50%;
            margin-right: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .btn-icon-split .text {
            font-size: 1rem;
        }

        .position-relative {
            position: relative;
        }

        .exclamation-circle {
            font-size: 1.5rem;
        }
        
        
        .edit-link {
            display: inline-flex;
            align-items: center;
            padding: 10px 15px;
            border-radius: 30px;
            background-color: #007bff;
            color: white;
            transition: background-color 0.3s ease, box-shadow 0.3s ease;
        }

        .edit-link:hover {
           
            text-decoration: none;
            box-shadow: 0px 4px 15px rgba(0, 0, 0, 0.2);
        }

        .edit-link i {
            margin-right: 5px;
        }

        .edit-link span {
            font-weight: bold;
        }

    </style>
</head>

<body>

   <div th:replace="~{user/my_abb_navbar :: my_app}"></div>   
	



<div class="container-fluid" style="margin-top: 100px;">
    <div class="row justify-content-center">
        <div class="col-xl-12 col-lg-7 centered-content mx-auto">
		
            <div class="card shadow ">
                <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                    <h5 class="m-0 d-flex justify-content-between align-items-center">
                        <span class="text-primary text-uppercase" style="font-size: 12px;">Merchant</span>
                    </h5>
                </div>
                <div class="card-body">
                    <div class="form-row mb-1">
                        <a class="btn btn-light btn-icon-split" th:if="${customer != null && customer.getFirstName() != null && customer.getLastName() != null && !customer.getFirstName().isEmpty()}" id="showLocation">
                            <span class="icon text-white-50">
                                <i class="fas fa-arrow-right"></i>
                            </span>
                            <span class="text" th:text="#{Click_to_Find_Merchants_Nearby}">Click to Find Merchants Nearby</span>
                        </a>
                        <a class="btn btn-light btn-icon-split position-relative alert-animation" th:if="${customer != null && (customer.getFirstName() == null || customer.getFirstName().isEmpty()) && (customer.getLastName() == null || customer.getLastName().isEmpty())}">
                            <span class="icon text-white-50">
                                <i class="fas fa-exclamation-circle exclamation-circle mt-3"></i>
                            </span>
                            <span class="text" th:text="#{fill_form}">Please Update Your First Name and Last Name Before Finding Merchants Nearby</span>
                        </a>
                    </div>
                    <div class="">
                        <div id="merchantList" class="d-flex overflow-auto row"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


<div class="container-fluid" style="margin-top: 5px;">
    <div class="row justify-content-center">
        <div class="col-xl-12 col-lg-7 centered-content mx-auto">
            <div class="card shadow" style="margin-bottom: 20px;">
                <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                    <h5 class="m-0 d-flex justify-content-between align-items-center">
                        <span class=" text-primary text-uppercase " style="font-size: 12px;">Profile</span>
                    </h5>
                </div>
                <div class="card-body mt-0" th:if="${profileScore < 80}">
                    <div class="profile-score-container">
                        <div class="profile-score-bar" th:style="'--percentage: ' + ${profileScore} + '%'" th:text="${profileScore}">
                            <span>Loading...</span>
                        </div>
                    </div>
                </div>
				  <div class="card-body" >
                    <div class="form-row py-2" >
                        <div class="col-12">
                            <!-- Earnings (Monthly) Card Example -->
                            <div class="card border-primary-all-sides shadow h-100 py-2 mb-1 card-3d-effect">
                                <div class="card-body">
                                    <div class="row no-gutters align-items-center">
                                        <div class="col mr-2">
                                            <div class="text-xs font-weight-bold text-primary text-uppercase mb-1">
												 <div class="user-icon">
                       								 <i class="fa fa-user"></i>
                   								</div>
												<span th:if="${customer.lastName == null}" th:text="${customer.firstName}" ></span>
												<span th:if="${customer.lastName != null}" th:text="${customer.firstName +' ' + customer.lastName}" ></span>
                                            </div>
                                            <div class="d-flex justify-content-between align-items-center">
                                                <div class="text-xs mb-0 font-weight-bold text-gray-800">
                                                    <a class="edit-link" th:href="@{/my_app/access/user/profile}"><i class="fa fa-edit"></i><span> Edit</span></a>
                                                </div>
                                                <div class="text-xs mb-0 font-weight-bold text-gray-800">
                                                    <span th:text="${customer.creationTime}">date</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
	                               	</div>
	                            </div>
                        		</div>
                    		</div>
                    	<div>	
					</div>
                </div>
                <!--<div class="card-body mt-0" th:if="${profileScore < 80}">
                    <div class="profile-score-container">
                        <div class="profile-score-bar" th:style="'--percentage: ' + ${profileScore} + '%'" th:text="${profileScore}">
                            <span>Loading...</span>
                        </div>
                    </div>
                </div>-->
            </div>
        </div>
    </div>
</div>

<!-- ./content container-->
<!-- jQuery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

<!-- Bootstrap JS (Optional) Important !!!--> 
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

<!-- DataTables JS -->
<script src="https://cdn.datatables.net/1.11.3/js/jquery.dataTables.min.js"></script>

<!-- DataTables Bootstrap 4 Integration JS -->
<!-- <script src="https://cdn.datatables.net/1.11.3/js/dataTables.bootstrap4.min.js"></script> -->

<!-- DataTables Select JS -->
<script src="https://cdn.datatables.net/select/1.3.3/js/dataTables.select.min.js"></script>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.10.0/css/bootstrap-datepicker.standalone.min.css" integrity="sha512-D5/oUZrMTZE/y4ldsD6UOeuPR4lwjLnfNMWkjC0pffPTCVlqzcHTNvkn3dhL7C0gYifHQJAIrRTASbMvLmpEug==" crossorigin="anonymous" referrerpolicy="no-referrer" />

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.10.0/css/bootstrap-datepicker.min.css" integrity="sha512-34s5cpvaNG3BknEWSuOncX28vz97bRI59UnVtEEpFX536A7BtZSJHsDyFoCl8S7Dt2TPzcrCEoHBGeM4SUBDBw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.10.0/js/bootstrap-datepicker.min.js" integrity="sha512-LsnSViqQyaXpD4mBBdRYeP6sRwJiJveh2ZIbW41EBrNmKxgr/LFZIiWT6yr+nycvhvauz8c2nYMhrP80YhG7Cw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.10.0/css/bootstrap-datepicker3.min.css" integrity="sha512-aQb0/doxDGrw/OC7drNaJQkIKFu6eSWnVMAwPN64p6sZKeJ4QCDYL42Rumw2ZtL8DB9f66q4CnLIUnAw28dEbg==" crossorigin="anonymous" referrerpolicy="no-referrer" />

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.10.0/css/bootstrap-datepicker3.standalone.min.css" integrity="sha512-t+00JqxGbnKSfg/4We7ulJjd3fGJWsleNNBSXRk9/3417ojFqSmkBfAJ/3+zpTFfGNZyKxPVGwWvaRuGdtpEEA==" crossorigin="anonymous" referrerpolicy="no-referrer" />

<!-- Your custom scripts -->
<script src="/js/script.js"></script> 
<script src="/js/side.js"></script>
<script src="/js/admin2.js"></script>
<script src="/js/admin2_min.js"></script>

<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/select/1.3.3/css/select.dataTables.min.css">

<script type="text/javascript">
	
	
	
$('#toggleLocation').click(function() {
    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(function(position) {
            // Success callback function
            console.log('Location retrieved successfully:', position);
            // Further processing of the location data...
        }, function(error) {
            // Error callback function
            console.error('Error occurred while retrieving location:', error);
            // Handle error...
        });
    } else {
        console.log('Geolocation is not supported by this browser.');
    }
});
	
	
$(document).ready(function() {
    $('#showLocation').click(function() {
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(function(position) {
                var latitude = position.coords.latitude;
                var longitude = position.coords.longitude;
                // Call function to fetch and display location details
                fetchAndDisplayLocation(latitude, longitude);
            }, function(error) {
                console.error('Error occurred while retrieving location:', error);
                $('#locationDisplay').html('<p>Unable to retrieve your location</p>');
            });
        } else {
            alert('Geolocation is not supported by this browser.');
        }
    });
    
});


function fetchAndDisplayLocation(latitude, longitude) {
    var apiUrl = 'https://api.opencagedata.com/geocode/v1/json?q=' + latitude + '%2C' + longitude + '&key=df47e50c41f74132be0e533422dd78e6';

    $.get(apiUrl, function(response) {
        if (response && response.results && response.results.length > 0) {
            // Extract location details from the response
            var location = response.results[0].components;
            // Display location details
            var locationDetails = {
                country: location.country,
                state: location.state,
                city: location.city || location.town || location.village || location.hamlet || 'Bengaluru', // Additional fallback options
                area: location.suburb || location.neighbourhood || location.village || 'Unknown'
            };
            sendLocationToBackend(locationDetails);
        } else {
            $('#locationDisplay').html('<p>Unable to retrieve location information</p>');
        }
    }).fail(function(jqXHR, textStatus, errorThrown) {
        console.error('Error occurred while fetching location:', errorThrown);
        $('#locationDisplay').html('<p>Error occurred while fetching location</p>');
    });
}


        
function sendLocationToBackend(locationDetails) {
    $.ajax({
    type: 'POST',
    url: '/api/merchant/search/store',
    contentType: 'application/json',
    data: JSON.stringify(locationDetails),
    success: function(response) {
        console.log('Location details sent to backend successfully:', response);
        // Handle the response from the backend if needed

        // Clear the previous content of the merchant list
        $('#merchantList').empty();

        // Iterate over the response array and append each merchant to the list
        response.forEach(function(merchant) {
           
          var cardHtml = `
                <div class="card_ border-left-primary shadow py-2 m-2" style="min-width: 80%;">
                    <div class="card-body d-flex flex-column">
                        <div class="row no-gutters flex-grow-1 align-items-center">
                            <div class="col mr-2">
                                <div class="text-xs font-weight-bold text-primary text-uppercase mb-1">
                                    ${merchant.name}</div>
                                <!--<div class="text-xs mb-0 font-weight-bold text-gray-800">${merchant.business.category}</div>-->
                                <div class="text-xs mb-0 font-weight-bold text-gray-800">
								   <a href="${'/my_app/access/'}${merchant.shortLink}" class="text-gray-800">${merchant.business.category}</a>


								</div>
								
 								<div class="text-xs mb-0 font-weight-bold text-gray-800">
									<span>${merchant.region.state}</span>&nbsp; <small>${merchant.region.city}</small>
								</div>

                            </div>
                            <div class="col-auto">
                                <i class="fas fa-store fa-2x text-gray-300"></i>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            
            $('#merchantList').append(cardHtml);
        });
    },
    error: function(xhr, status, error) {
        console.error('Error occurred while sending location details to backend:', error);
        // Handle the error and display a message to the user
    }
});

}


document.addEventListener("DOMContentLoaded", function() {
    var profileScore = parseInt(document.querySelector('.profile-score-bar').textContent);
    var color = calculateColor(profileScore);
    document.documentElement.style.setProperty('--color', color);
});

function calculateColor(score) {
    if (score <= 25) {
        return '#ff0000'; // Red color for 0-25%
    } else if (score <= 50) {
        return '#ffff00'; // Yellow color for 26-50%
    } else if (score <= 75) {
        return '#00ff00'; // Green color for 51-75%
    } else {
        return '#0000ff'; // Blue color for 76-100%
    }
}
        
        

	/*window.onload = function() {
        var card = document.getElementById('dynamicCard');
        var cardBody = card.querySelector('.card-body');
        card.style.height = cardBody.offsetHeight + 'px'; // Set card height based on card body content height
    }*/

</script>
</body>
</html>